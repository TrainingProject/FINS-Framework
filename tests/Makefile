# fins.mk contains the compiler and linker options for each target platform
include ../settings.finsmk

#This is the Module name. This MUST be that same as the current directory!!!
PROJECT_NAME = tests

#Additional includes for FINS core modules
CFLAGS += $(TESTS_INC)

#add the names of any executables that are added to this directory here.  This
#ensures that they will be removed by clean
EXECUTABLES =  server server_forks client server_tcp client_tcp

#This is an autogenerated list of includes used in this project.
INCLUDES = $(foreach DIR_NAME, $(subst -I,, $(strip $(TESTS_INC))), $(addprefix $(DIR_NAME)/, $(shell ls $(DIR_NAME)| grep \\.h)))




##### TARGETS #####
.PHONY:all
all:$(EXECUTABLES) userspace_tests
	@echo "$(PROJECT_NAME) is compiled\n"

client:client.c $(INCLUDES)
	@$(CC) $(CFLAGS) $(INTERCEPTOR_INC) -c $< 
	@$(LD) $(LDFLAGS) $@.o -o $@

client_tcp:client_tcp.c $(INCLUDES)
	@$(CC) $(CFLAGS) $(INTERCEPTOR_INC) -c $< 
	@$(LD) $(LDFLAGS) $@.o -o $@
	
server:server.c $(INCLUDES)
	@$(CC) $(CFLAGS) $(INTERCEPTOR_INC) -c $< 
	@$(LD) $(LDFLAGS) $@.o -o $@

server_forks:server_forks.c $(INCLUDES)
	@$(CC) $(CFLAGS) $(INTERCEPTOR_INC) -c $< 
	@$(LD) $(LDFLAGS) $@.o -o $@

server_tcp:server_tcp.c $(INCLUDES)
	@$(CC) $(CFLAGS) $(INTERCEPTOR_INC) -c $< 
	@$(LD) $(LDFLAGS) $@.o -o $@

userspace_tests:
	@cd Userspace_tests; make all

.PHONY:clean
clean:
	@rm -f *.o 
	@rm -f $(EXECUTABLES) 
	@cd Userspace_tests; make clean
